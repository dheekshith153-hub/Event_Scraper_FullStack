.PHONY: help build run clean test install db-create db-drop logs

# Variables
BINARY_NAME=event-scraper
GO_FILES=$(shell find . -name '*.go' -type f)

help: ## Show this help message
	@echo 'Usage: make [target]'
	@echo ''
	@echo 'Available targets:'
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  %-15s %s\n", $$1, $$2}' $(MAKEFILE_LIST)

install: ## Install dependencies
	@echo "ğŸ“¦ Installing dependencies..."
	go mod download
	go mod tidy
	@echo "âœ… Dependencies installed"

build: ## Build the application
	@echo "ğŸ”¨ Building application..."
	go build -o $(BINARY_NAME) cmd/scraper/main.go
	@echo "âœ… Build complete: ./$(BINARY_NAME)"

run: ## Run the application
	@echo "ğŸš€ Running application..."
	go run cmd/scraper/main.go

clean: ## Clean build artifacts
	@echo "ğŸ§¹ Cleaning..."
	rm -f $(BINARY_NAME)
	rm -f event-scraper-*
	rm -rf logs/*.log
	@echo "âœ… Cleaned"

test: ## Run tests
	@echo "ğŸ§ª Running tests..."
	go test -v ./...

db-create: ## Create PostgreSQL database
	@echo "ğŸ“Š Creating database..."
	createdb event_scraper || echo "Database may already exist"
	@echo "âœ… Database created"

db-drop: ## Drop PostgreSQL database
	@echo "âš ï¸  Dropping database..."
	dropdb event_scraper || echo "Database may not exist"
	@echo "âœ… Database dropped"

db-reset: db-drop db-create ## Reset database
	@echo "â™»ï¸  Database reset complete"

logs: ## View logs
	@tail -f logs/scraper.log

format: ## Format Go code
	@echo "ğŸ¨ Formatting code..."
	go fmt ./...
	@echo "âœ… Code formatted"

lint: ## Run linter
	@echo "ğŸ” Running linter..."
	golangci-lint run ./...

build-all: ## Build for all platforms
	@echo "ğŸ”¨ Building for all platforms..."
	GOOS=linux GOARCH=amd64 go build -o $(BINARY_NAME)-linux cmd/scraper/main.go
	GOOS=windows GOARCH=amd64 go build -o $(BINARY_NAME).exe cmd/scraper/main.go
	GOOS=darwin GOARCH=amd64 go build -o $(BINARY_NAME)-mac cmd/scraper/main.go
	@echo "âœ… Build complete for all platforms"

docker-build: ## Build Docker image
	@echo "ğŸ³ Building Docker image..."
	docker build -t event-scraper:latest .

docker-run: ## Run Docker container
	@echo "ğŸ³ Running Docker container..."
	docker-compose up -d
